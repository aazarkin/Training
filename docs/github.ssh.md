# Github Public Key Authentication

When interacting with GitHub, it is important your identity properly appears in commit logs.
The above requires maintaining user's private and public encryption keys in order.

## Public and Private Keys

First, a user creates a public and private key pair using `ssh-keygen` command in Linux:

```
ssh-keygen -t rsa -b 4096 -C "jsmith@gmail.com" -f ~/.ssh/jsmith
```

** When prompted for a pass-phrase, the user may choose to hit `Enter` and skip it.
If the user enters a pass-phrase, the user will be prompted for the pass-phrase each time the private key is used.

The above command generates two (2) files in `~/.ssh` directory:

- `jsmith`: PKCS#1 RSA ***private*** key. encoded in PEM (Privacy Enhanced Mail) format

    ```
    -----BEGIN RSA PRIVATE KEY-----
    MIIJKAIBAAKCAgEA3tUFynlbzK5VOKiDRLvdgf/zzpouB8pNKibA/ND5MaWSN9Pz
    ... omitted ...
    fDxbZRfVmen1j/10GPSw4SVs6ioIxsKCY+3CxE9P3ZbPSxRk6SQpHi8AFCs=
    -----END RSA PRIVATE KEY-----
    ```

- `jsmith.pub`: a ***public*** key in OpenSSH compatible format

    ```
    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDe1QXKeVvMrlU4qINEu92B//POmi4Hyk0qJsD80PkxpZI30/OM9s1He/ks2YSWxz/5jJQ1Q4xI/WrAdVqGf563h4VDaBld8mr4NQ8Xx7c9OnaOIYAmIN5FIF8x4zaIgFDfihKaETXOB0K2Gg2hgbopIeUxzO7qwSkIVszKYQisLjCFtF1hSWkYdGBKIyy7tY3BK1ouniQRMphyqVqZ6wQlv59V64Pk8gIdgxGtkEf3W0uhmhwwPtxhIo75+60KofGJL92ln3LtLsmxrnBxEGDVyZKpY7BnSlbe//5DJVL3l0gnN/FYMosxwny377QKQtWdClNtQv0G1q5e1LKx53gxqzRBdXkTWl5MvdKm8uZ8f51f7XWJBkeGMfHFXy/K1vjMpRjPI1Zujpv5axDXFyOW3Ov0Vl1/aXgypo6Vp5YBa7YlakP8AmdOidVkE4HjPFRI+GJMvYwohWj0McWmVMqAmKwseFg8UirEbaA3PJBNeeRZp13v6jrv1qOvXlKcI8uexrK/cmhj6Jb5IllLPmMF4qdz7bBzg3m45qF5wZilCFGKx8Nq1It+pxlophYHq14NnFKyicv574P4pjBQS8iTRn4KCUQGVOaT9na7RrGrAJ45IsOrrGtxZm8OBUH24M1l+Q3nvxVeEkccuqZJU1CaHfAEByjDqt+ST8+bXfwCSQ== jsmith@gmail.com
    ```

It is important for the user to rename `jsmith` to `jsmith.pem` to avoid confusion as to what that file is.

```
mv ~/.ssh/jsmith ~/.ssh/jsmith.pem
```

Additionally, if a user only has a ***private***, then the user may generate a ***public*** key
in OpenSSH compatible format. It is done using `ssh-keygen` tool:

```
ssh-keygen -y -f ~/.ssh/jsmith.pem >  ~/.ssh/jsmith.pub
```

Now, the `jsmith.pub` may be used for `authorized_keys` OpenSSH file.

After completing the above instructions, the user should have the following files:

- `~/.ssh/jsmith.pem`
- `~/.ssh/jsmith.pub`

## GitHub Integration and Testing

If a users wants you use private-public key authentication method when accessing GitHub,
the user should provide his or her ***public*** key to GitHub.

The user should browse to GitHub **Settings** in his or her profile, then to **SSH keys** section.

There, the user should click **Add SSH key** button, enter key title, e.g. `jsmith@gmail.com` and
paste the contents of `~/.ssh/jsmith.pub` into **Key** field.

Once the user click **Add Key**, the user get presented with a similar output:

```
jsmith@gmail.com
66:d0:7c:b5:c9:79:8b:5e:80:36:72:17:44:b7:1d:37
Added on Jul 30, 2015 Never used
```

The `66:d0:7c:b5:c9:79:8b:5e:80:36:72:17:44:b7:1d:37` is a *fingerprint*.
The fingerprint in GitHub should match the fingerprint generated by 
the `ssh-keygen -lf ~/.ssh/jsmith.pub` command:

```
$ ssh-keygen -lf ~/.ssh/jsmith.pub
4096 66:d0:7c:b5:c9:79:8b:5e:80:36:72:17:44:b7:1d:37  jsmith@gmail.com (RSA)
```

Now, the user may test access to GitHub via SSH:

```
ssh -i ~/.ssh/jsmith.pem -T git@github.com
```

The expected output is:

```
$ ssh -i ~/.ssh/jsmith.pem -T git@github.com
Hi jsmith! You've successfully authenticated, but GitHub does not provide shell access.
$ 
```

A user may choose to make `-i ~/.ssh/jsmith.pem` its default SSH public key.
The user may simply copy the private/public key pair to default location:

```
cp ~/.ssh/jsmith.pem ~/.ssh/id_rsa
cp ~/.ssh/jsmith.pub ~/.ssh/id_rsa.pub
```

or create a symbolic link:

```
ln -s ~/.ssh/jsmith.pem ~/.ssh/id_rsa
ln -s ~/.ssh/jsmith.pub ~/.ssh/id_rsa.pub
```

Additionally, please check that your public key is visible at
[https://github.com/jsmith.keys](https://github.com/jsmith.keys).

## SSH Client Config

Create a file `~/.ssh/config` with the following contents:

```
Host *
  ServerAliveInterval 60

Host github.com-jsmith
  HostName github.com
  IdentityFile ~/.ssh/jsmith.pem
  User jsmith
```
